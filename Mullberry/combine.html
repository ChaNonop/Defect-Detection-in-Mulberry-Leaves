<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8">
    <title>Mulberry Leaf Inspector | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        background: #f9fafb url('https://www.qsds.go.th/images/bg_thai_pattern.png') repeat;
        font-family: "TH Sarabun New", sans-serif;
      }
      .navbar {
        background: linear-gradient(90deg, #3b7a57, #6aa84f);
        color: white;
      }
      .navbar-brand, .navbar small {
        color: white !important;
      }
      .img-preview { 
        max-width: 100%; 
        height: auto; 
        border: 2px solid #c9d6c5; 
        padding: 4px; 
        background: #fff; 
        border-radius: 10px;
      }
      .hidden { display: none; }
      .card {
        border-radius: 15px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      }
      .recommend {
        background: #e9f7ef;
        border-left: 4px solid #4caf50;
        padding: 10px 15px;
        border-radius: 8px;
        margin-top: 10px;
      }
      footer {
        background: #3b7a57;
        color: white;
        padding: 20px 0;
        text-align: center;
        margin-top: 50px;
      }
    </style>
  </head>
  <body>

    <!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-white shadow-sm">
  <div class="container d-flex align-items-center">
    <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏´‡∏•‡∏±‡∏Å -->
    <img src="https://foodindustry.kmitl.ac.th/sites/default/files/inline-images/2Main%20Logo%20KMITL_Eng%20Orange.png"
         alt="KMITL Logo" height="90" class="me-3">

    <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ Sitename -->
    <img src="https://www.kmitl.ac.th/sites/default/files/2025-03/Sitename.png"
         alt="Sitename Logo" height="70">

    <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ -->
    <div class="ms-auto text-end">
      <small class="text-muted">G3 Mulberry Leaf classification</small>
    </div>
  </div>
</nav>

    <div class="container mt-4">
      
      <!-- Upload Section -->
      <div class="card p-4" id="upload-card">
        <h5 class="fw-bold text-success">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö üçÉ</h5>
        <p class="text-muted">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏ô‡∏¥‡∏î‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô ‚Äî ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞‡πÉ‡∏ö‡∏î‡∏µ ‡πÉ‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ ‡πÉ‡∏ö‡∏ñ‡∏π‡∏Å‡πÅ‡∏°‡∏•‡∏á‡∏Å‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô
        </p>
        <form id="uploadForm" onsubmit="handleUpload(event)">
          <div class="mb-3">
            <input class="form-control" type="file" id="fileInput" accept="image/*" required>
          </div>
          <button class="btn btn-success" type="submit" id="uploadBtn" disabled>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
        </form>
        <div id="loadingMessage" class="mt-3 hidden">
          <div class="spinner-border text-success" role="status">
            <span class="visually-hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</span>
          </div>
          <span class="ms-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•...</span>
        </div>
      </div>

      <!-- Result Section -->
      <div class="card p-4 mt-4 hidden" id="result-card">
        <h5 class="fw-bold text-primary">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô ‚ú®</h5>
        <div class="row mt-3">
          <div class="col-md-6">
            <h6>‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</h6>
            <img id="uploadedImage" class="img-preview" alt="Uploaded Mulberry Leaf">
          </div>
          <div class="col-md-6">
            <h6>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</h6>
            <canvas id="predictionChart"></canvas>
            <hr>
            
            <h5 class="text-success">‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÑ‡∏î‡πâ: <span class="fw-bold" id="topClass"></span></h5>
            <div id="recommendationText" class="recommend"></div>

            <h6 class="mt-3">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h6>
            <ul id="allProbsList" class="list-unstyled small"></ul>
            <button class="btn btn-outline-success mt-2" onclick="resetPage()">‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
          </div>
        </div>
      </div>

      <!-- Knowledge Section -->
      <div class="card p-4 mt-5">
        <h4 class="fw-bold text-success">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏° üêõ</h4>
        <p>
          ‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏° ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏µ‡∏ú‡∏•‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÑ‡∏´‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏≠‡∏ô‡πÑ‡∏´‡∏°  
          ‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ö‡∏≠‡πà‡∏≠‡∏ô‡∏û‡∏≠‡πÄ‡∏´‡∏°‡∏≤‡∏∞ ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏î ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏°‡∏•‡∏á‡∏Å‡∏±‡∏î‡∏Å‡∏¥‡∏ô  
          ‡∏Å‡∏£‡∏°‡∏´‡∏°‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏´‡∏°‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤ ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 60  
        </p>
        <ul>
          <li><strong>‡πÉ‡∏ö‡∏î‡∏µ (Good leaf):</strong> ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</li>
          <li><strong>‡πÉ‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ (Fungal leaf):</strong> ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏° ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏°‡∏õ‡πà‡∏ß‡∏¢</li>
          <li><strong>‡πÉ‡∏ö‡∏ñ‡∏π‡∏Å‡πÅ‡∏°‡∏•‡∏á‡∏Å‡∏±‡∏î (Insect-eaten leaf):</strong> ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏•‡∏î‡∏•‡∏á ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏¢‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ</li>
          
        </ul>
      </div>
    </div>

    <footer>
      <p>¬© 2025 ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ‡∏Å‡∏£‡∏°‡∏´‡∏°‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏° ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå | ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ G3 mulberry leaf classification</p>
    </footer>

    <!-- Script -->
    <script>
      const API_ENDPOINT = 'https://g3weds.consolutechcloud.com/backend/predict';
      const classNames = ['Fungal leaves', 'Good leaves', 'Insect-eaten leaves', 'Not mulberry leaf'];
      const recommendationMap = {
        'Fungal leaves': '‚ùó ‡πÉ‡∏ö‡∏°‡∏µ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ ‚Äî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏¢‡∏Å‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏•‡∏≤‡∏¢ ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÇ‡∏î‡∏¢‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î',
        'Good leaves': '‚úÖ ‡πÉ‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‚Äî ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ',
        'Insect-eaten leaves': '‚ö†Ô∏è ‡πÉ‡∏ö‡∏ñ‡∏π‡∏Å‡πÅ‡∏°‡∏•‡∏á‡∏Å‡∏±‡∏î ‚Äî ‡πÉ‡∏ä‡πâ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏î‡πâ ‡∏Ñ‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏°‡∏≤‡∏Å',
        'Not mulberry leaf': 'üö´ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÉ‡∏ö‡∏´‡∏°‡πà‡∏≠‡∏ô ‚Äî ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÑ‡∏´‡∏° ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏≠‡∏ô‡πÑ‡∏´‡∏°'
      };

      const fileInput = document.getElementById('fileInput');
      const uploadBtn = document.getElementById('uploadBtn');
      const uploadCard = document.getElementById('upload-card');
      const resultCard = document.getElementById('result-card');
      const loadingMessage = document.getElementById('loadingMessage');
      const uploadedImage = document.getElementById('uploadedImage');
      const topClassSpan = document.getElementById('topClass');
      const recommendationP = document.getElementById('recommendationText');
      const allProbsList = document.getElementById('allProbsList');
      let chartInstance = null;

      fileInput.addEventListener('change', (event) => {
          uploadBtn.disabled = event.target.files.length === 0;
      });

      function resetPage() {
          uploadCard.classList.remove('hidden');
          resultCard.classList.add('hidden');
          fileInput.value = '';
          uploadBtn.disabled = true;
          if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
      }

      function createChart(probs) {
          const ctx = document.getElementById('predictionChart').getContext('2d');
          const combined = classNames.map((name, i) => ({ name, prob: probs[i] }));
          combined.sort((a, b) => b.prob - a.prob);
          chartInstance = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: combined.map(item => item.name),
                  datasets: [{
                      label: 'Confidence (%)',
                      data: combined.map(item => item.prob * 100),
                      backgroundColor: ['#ff6384','#4caf50','#ffb74d','#9e9e9e'],
                      borderWidth: 1
                  }]
              },
              options: { indexAxis: 'y', scales: { x: { beginAtZero: true, max: 100 }}, plugins: { legend: { display: false } } }
          });
      }

      async function handleUpload(e) {
          e.preventDefault();
          if (fileInput.files.length === 0) return;
          const file = fileInput.files[0];
          const reader = new FileReader();
          reader.onloadstart = () => { uploadBtn.disabled = true; loadingMessage.classList.remove('hidden'); };
          reader.onload = async (e) => {
              const base64Image = e.target.result;
              uploadedImage.src = base64Image;
              try {
                  const response = await fetch(API_ENDPOINT, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify({ image_base64: base64Image })
                  });
                  const data = await response.json();
                  const topClass = data.predicted_class_name;
                  topClassSpan.textContent = topClass;
                  recommendationP.textContent = recommendationMap[topClass] || '';
                  const logits = data.prediction[0];
                  const exp = logits.map(Math.exp);
                  const sumExp = exp.reduce((a,b)=>a+b,0);
                  const probs = exp.map(v => v/sumExp);
                  allProbsList.innerHTML = '';
                  classNames.forEach((name, i) => {
                      const li = document.createElement('li');
                      li.innerHTML = `<strong>${name}:</strong> ${(probs[i]*100).toFixed(2)}%`;
                      allProbsList.appendChild(li);
                  });
                  createChart(probs);
                  uploadCard.classList.add('hidden');
                  resultCard.classList.remove('hidden');
              } catch (error) {
                  alert('‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message);
              } finally {
                  loadingMessage.classList.add('hidden');
                  uploadBtn.disabled = false;
              }
          };
          reader.readAsDataURL(file);
      }
    </script>
  </body>
</html>
